/**
 * @preserve
 * Kontra.js v10.0.2
 */
function t(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function e(t,e,i){return{x:t.x+Math.cos(e)*i,y:t.y+Math.sin(e)*i}}function i(t,e){let i=n(t),s=n(e);return i.x<s.x+s.width&&i.x+i.width>s.x&&i.y<s.y+s.height&&i.y+i.height>s.y}function n(t){let{x:e=0,y:i=0,width:n,height:s,radius:h}=t.world||t;return t.mapwidth&&(n=t.mapwidth,s=t.mapheight),t.anchor&&(e-=n*t.anchor.x,i-=s*t.anchor.y),n<0&&(e+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:e,y:i,width:n,height:s}}function s(t,e,i="y"){return[t,e]=[t,e].map(n),t[i]-e[i]}let h=()=>{},r={preventScroll:!0};function a(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){([...i.querySelectorAll(":scope > [data-kontra]")].pop()||e).after(t)}else"CANVAS"==e.nodeName?document.body.append(t):e.append(t)}function o(t,e){let{x:i,y:s,width:h,height:r}=n(e);do{i-=e.sx||0,s-=e.sy||0}while(e=e.parent);let a=t.x-Math.max(i,Math.min(t.x,i+h)),o=t.y-Math.max(s,Math.min(t.y,s+r));return a*a+o*o<t.radius*t.radius}let c,d,l={};function u(t,e){l[t]=l[t]||[],l[t].push(e)}function p(t,...e){(l[t]||[]).map((t=>t(...e)))}let f={get:(t,e)=>"_proxy"==e||h};function w(){return c}function g(){return d}function m(t,{contextless:e=!1}={}){return c=document.getElementById(t)||t||document.querySelector("canvas"),e&&(c=c||new Proxy({},f)),d=c.getContext("2d")||new Proxy({},f),d.imageSmoothingEnabled=!1,p("init"),{canvas:c,context:d}}class _{constructor({spriteSheet:t,frames:e,frameRate:i,loop:n=!0,name:s}){let{width:h,height:r,spacing:a=0,margin:o=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:n,name:s,width:h,height:r,spacing:a,margin:o,isStopped:!1,_f:0,_a:0})}clone(){return new _(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped)if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}render({x:t,y:e,width:i=this.width,height:n=this.height,context:s=g()}){let h=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,this.margin+r*this.width+(2*r+1)*this.spacing,this.margin+h*this.height+(2*h+1)*this.spacing,this.width,this.height,t,e,i,n)}}function x(){return new _(...arguments)}let y=/^\//,v=/\/$/,b=new WeakMap;function S(t,e){return new URL(t,e).href}let A={},k={};function E(t){return window.__k||(window.__k={dm:b,u:S,d:k,i:A}),new Promise(((e,i)=>{let n,s,h;if(n=function(t,e){return[t.replace(v,""),e].filter((t=>t)).join("/")}("",t),A[n])return e(A[n]);s=new Image,s.onload=function(){h=S(n,window.location.href),A[function(t){let e=t.replace("."+function(t){return t.split(".").pop()}(t),"");return 2==e.split("/").length?e.replace(y,""):e}(t)]=A[n]=A[h]=this,p("assetLoaded",this,t),e(this)},s.onerror=function(){i(n)},s.src=n}))}class L{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new L(this.x+t.x,this.y+t.y,this)}}class X{constructor(t){return this.init(t)}init(t={}){this.position=function(){return new L(...arguments)}(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){}_pc(){}}class Y extends X{init({width:t=0,height:e=0,context:i=g(),render:n=this.draw,update:s=this.advance,anchor:h={x:0,y:0},scaleX:r=1,scaleY:a=1,...o}={}){super.init({width:t,height:e,context:i,anchor:h,scaleX:r,scaleY:a,...o}),this._di=!0,this._uw(),this._rf=n,this._uf=s,u("init",(()=>{this.context??=g()}))}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height,n=-e*this.anchor.x,s=-i*this.anchor.y;(n||s)&&t.translate(n,s),this._rf(),(n||s)&&t.translate(-n,-s),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wsx:i=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wsx=i*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*i,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,scaleX:this._wsx,scaleY:this._wsy}}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class M extends Y{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...n}={}){super.init({image:t,width:e,height:i,...n})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function C(){return new M(...arguments)}let O=new WeakMap,j={},F={},D={0:"left",1:"middle",2:"right"};function R(t=w()){return O.get(t)}function G(t,e){return parseFloat(t.getPropertyValue(e))||0}function P(t){let e=null!=t.button?D[t.button]:"left";F[e]=!0,N(t,"onDown")}function B(t){let e=null!=t.button?D[t.button]:"left";F[e]=!1,N(t,"onUp")}function I(t){N(t,"onOver")}function W(t){O.get(t.target)._oo=null,F={}}function q(t,e,i){let n=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let n=e[i];if(n.collidesWithPointer?n.collidesWithPointer(t):o(t,n))return n}}(t);n&&n[e]&&n[e](i),j[e]&&j[e](i,n),"onOver"==e&&(n!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=n)}function N(t,e){t.preventDefault();let i=t.target,n=O.get(i),{scaleX:s,scaleY:h,offsetX:r,offsetY:a}=function(t){let{canvas:e,_s:i}=t,n=e.getBoundingClientRect(),s="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(s[0]),r=parseFloat(s[3]),a=(G(i,"border-left-width")+G(i,"border-right-width"))*h,o=(G(i,"border-top-width")+G(i,"border-bottom-width"))*r,c=(G(i,"padding-left")+G(i,"padding-right"))*h,d=(G(i,"padding-top")+G(i,"padding-bottom"))*r;return{scaleX:(n.width-a-c)/e.width,scaleY:(n.height-o-d)/e.height,offsetX:n.left+(G(i,"border-left-width")+G(i,"padding-left"))*h,offsetY:n.top+(G(i,"border-top-width")+G(i,"padding-top"))*r}}(n);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let o=n.touches[i];o||(o=n.touches[i]={start:{x:(t-r)/s,y:(e-a)/h}},n.touches.length++),o.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:o,identifier:c})=>{let d=n.touches[c];d.changed=!0,d.x=n.x=(i-r)/s,d.y=n.y=(o-a)/h,q(n,e,t),p("touchChanged",t,n.touches),"onUp"==e&&(delete n.touches[c],n.touches.length--,n.touches.length||p("touchEnd"))}))):(n.x=(t.clientX-r)/s,n.y=(t.clientY-a)/h,q(n,e,t))}function U(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function H({fps:t=60,clearCanvas:e=!0,update:i=h,render:n,context:s=g(),blur:r=!1}={}){let a,o,c,d,l,f=0,w=1e3/t,m=1/t,_=e?U:h,x=!0;function y(){if(o=requestAnimationFrame(y),x&&(c=performance.now(),d=c-a,a=c,!(d>1e3))){for(f+=d;f>=w;)p("tick"),l.update(m),f-=w;_(l.context),l.render()}}return r||(window.addEventListener("focus",(()=>{x=!0})),window.addEventListener("blur",(()=>{x=!1}))),u("init",(()=>{l.context??=g()})),l={update:i,render:n,isStopped:!0,context:s,start(){this.isStopped&&(a=performance.now(),this.isStopped=!1,requestAnimationFrame(y))},stop(){this.isStopped=!0,cancelAnimationFrame(o)}},l}let V=[],K={},T={},$={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function z(t){V[t.gamepad.index]={pressedButtons:{},axes:{}}}function J(t){delete V[t.gamepad.index]}function Q(){V.map((t=>{t.pressedButtons={},t.axes={}}))}function Z(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map(((t,e)=>{let n=$[e],{pressed:s}=t,{pressedButtons:h}=V[i.index],r=h[n];!r&&s?[K[i.index],K].map((e=>{e?.[n]?.(i,t,n)})):r&&!s&&[T[i.index],T].map((e=>{e?.[n]?.(i,t,n)})),h[n]=s}));let{axes:n}=V[i.index];n.leftstickx=i.axes[0],n.leftsticky=i.axes[1],n.rightstickx=i.axes[2],n.rightsticky=i.axes[3]}}let tt,et={},it=!1,nt={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,n=Math.abs(e),s=Math.abs(i);if(!(n<this.threshold&&s<this.threshold))return n>s?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let n=i>this.prevDist?"out":"in";return this.prevDist=i,n}}};let st,ht={},rt={},at={},ot={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function ct(t=h,e){t._pd&&e.preventDefault(),t(e)}function dt(t){let e=ot[t.code],i=ht[e];at[e]=!0,ct(i,t)}function lt(t){let e=ot[t.code],i=rt[e];at[e]=!1,ct(i,t)}function ut(){at={}}function pt(t,e,{handler:i="keydown",preventDefault:n=!0}={}){let s="keydown"==i?ht:rt;e._pd=n,[].concat(t).map((t=>s[t]=e))}function ft(t={}){!function(){let t;for(t=0;t<26;t++)ot["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)ot["Digit"+t]=ot["Numpad"+t]=""+t;window.addEventListener("keydown",dt),window.addEventListener("keyup",lt),window.addEventListener("blur",ut)}();let e=function({radius:t=5,canvas:e=w()}={}){let i=O.get(e);if(!i){let n=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:n},O.set(e,i)}return e.addEventListener("mousedown",P),e.addEventListener("touchstart",P),e.addEventListener("mouseup",B),e.addEventListener("touchend",B),e.addEventListener("touchcancel",B),e.addEventListener("blur",W),e.addEventListener("mousemove",I),e.addEventListener("touchmove",I),i._t||(i._t=!0,u("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0}))),i}(t.pointer);return it||(it=!0,u("touchChanged",((t,e)=>{Object.keys(nt).map((i=>{let n,s=nt[i];(!tt||tt==i)&&e.length==s.touches&&[...Array(e.length).keys()].every((t=>e[t]))&&(n=s[t.type]?.(e)??"")&&et[i+n]&&(tt=i,et[i+n](t,e))}))})),u("touchEnd",(()=>{tt=0}))),window.addEventListener("gamepadconnected",z),window.addEventListener("gamepaddisconnected",J),window.addEventListener("blur",Q),u("tick",Z),{pointer:e}}function wt(){st??=Date.now(),st|=0,st=st+2654435769|0;let t=st^st>>>16;return t=Math.imul(t,569420461),t^=t>>>15,t=Math.imul(t,1935289751),((t^=t>>>15)>>>0)/4294967296}function gt(t,e,i=wt){return(i()*(e-t+1)|0)+t}function mt(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((t=>{e=e.concat(mt(t))})),e}class _t{constructor({id:t,name:e=t,objects:n=[],context:s=g(),cullObjects:h=!0,cullFunction:r=i,sortFunction:o,...c}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:h,cullFunction:r,sortFunction:o,...c});let d=this._dn=document.createElement("section");d.tabIndex=-1,d.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",d.id=t,d.setAttribute("aria-label",e);let l=this;this.camera=new class extends Y{set x(t){l.sx=t-this.centerX,super.x=t}get x(){return super.x}set y(t){l.sy=t-this.centerY,super.y=t}get y(){return super.y}}({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(n),this._i=()=>{this.context??=g();let t=this.context.canvas,{width:e,height:i}=t,n=e/2,s=i/2;Object.assign(this.camera,{centerX:n,centerY:s,x:n,y:s,width:e,height:i}),d.isConnected||a(d,t)},this.context&&this._i(),u("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map((t=>{this._o.push(t),t.parent=this,this._dn.append(...mt(t))}))}remove(...t){t.flat().map((t=>{!function(t,e){let i=t.indexOf(e);if(-1!=i)t.splice(i,1)}(this._o,t),t.parent=null,mt(t).map((t=>{a(t,this.context.canvas)}))}))}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find((t=>t.focus));t?t.focus(r):this._dn.focus(r),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){var t,e;t="init",e=this._i,l[t]=(l[t]||[]).filter((t=>t!=e)),this._dn.remove(),this._o.map((t=>t.destroy&&t.destroy()))}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map((e=>e.update&&e.update(t)))}_rf(){let{_o:t,context:e,_sx:i,_sy:n,camera:s,sortFunction:h,cullObjects:r,cullFunction:a}=this;e.translate(i,n);let o=t;r&&(o=o.filter((t=>a(s,t)))),h&&o.sort(h),o.map((t=>t.render&&t.render()))}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:n,centerX:s,centerY:h}=e;t.save(),this._sx=s-i,this._sy=h-n,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function xt(){return new _t(...arguments)}function yt(t){if(+t==t)return t;let e=[],i=t.split(".."),n=+i[0],s=+i[1],h=n;if(n<s)for(;h<=s;h++)e.push(h);else for(;h>=s;h--)e.push(h);return e}class vt{constructor({image:t,frameWidth:e,frameHeight:i,spacing:n=0,margin:s=0,animations:h}={}){this.animations={},this.image=t,this.frame={width:e,height:i,spacing:n,margin:s},this._f=(t.width-s)/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:n,frameRate:s,loop:h}=t[i];e=[],[].concat(n).map((t=>{e=e.concat(yt(t))})),this.animations[i]=x({spriteSheet:this,frames:e,frameRate:s,loop:h,name:i})}}}function bt(){return new vt(...arguments)}export{H as GameLoop,Y as GameObjectClass,xt as Scene,C as Sprite,M as SpriteClass,bt as SpriteSheet,t as angleToTarget,i as collides,s as depthSort,R as getPointer,m as init,ft as initInput,E as loadImage,e as movePoint,pt as onKey,gt as randInt};
