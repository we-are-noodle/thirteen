/**
 * @preserve
 * Kontra.js v10.0.2
 */
function t(t,e){return Math.atan2(e.y-t.y,e.x-t.x)}function e(t,e,i){return{x:t.x+Math.cos(e)*i,y:t.y+Math.sin(e)*i}}function i(t,e){let i=n(t),s=n(e);return i.x<s.x+s.width&&i.x+i.width>s.x&&i.y<s.y+s.height&&i.y+i.height>s.y}function n(t){let{x:e=0,y:i=0,width:n,height:s,radius:h}=t.world||t;return t.mapwidth&&(n=t.mapwidth,s=t.mapheight),t.anchor&&(e-=n*t.anchor.x,i-=s*t.anchor.y),{x:e,y:i,width:n,height:s}}function s(t,e,i="y"){return[t,e]=[t,e].map(n),t[i]-e[i]}let h=()=>{},r={preventScroll:!0};function o(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){([...i.querySelectorAll(":scope > [data-kontra]")].pop()||e).after(t)}else"CANVAS"==e.nodeName?document.body.append(t):e.append(t)}function a(t,e){let{x:i,y:s,width:h,height:r}=n(e);do{i-=e.sx||0,s-=e.sy||0}while(e=e.parent);let o=t.x-Math.max(i,Math.min(t.x,i+h)),a=t.y-Math.max(s,Math.min(t.y,s+r));return o*o+a*a<t.radius*t.radius}let d,c,u={};function l(t,e){u[t]=u[t]||[],u[t].push(e)}function p(t,...e){(u[t]||[]).map((t=>t(...e)))}let f={get:(t,e)=>"_proxy"==e||h};function g(){return d}function m(){return c}function w(t,{contextless:e=!1}={}){return d=document.getElementById(t)||t||document.querySelector("canvas"),e&&(d=d||new Proxy({},f)),c=d.getContext("2d")||new Proxy({},f),c.imageSmoothingEnabled=!1,p("init"),{canvas:d,context:c}}class x{constructor({spriteSheet:t,frames:e,frameRate:i,loop:n=!0,name:s}){let{width:h,height:r,spacing:o=0,margin:a=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:i,loop:n,name:s,width:h,height:r,spacing:o,margin:a,isStopped:!1,_f:0,_a:0})}clone(){return new x(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped)if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}render({x:t,y:e,width:i=this.width,height:n=this.height,context:s=m()}){let h=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,this.margin+r*this.width+(2*r+1)*this.spacing,this.margin+h*this.height+(2*h+1)*this.spacing,this.width,this.height,t,e,i,n)}}function _(){return new x(...arguments)}let y=/^\//,v=/\/$/,b=new WeakMap;function S(t,e){return new URL(t,e).href}let A={},k={};function E(t){return window.__k||(window.__k={dm:b,u:S,d:k,i:A}),new Promise(((e,i)=>{let n,s,h;if(n=function(t,e){return[t.replace(v,""),e].filter((t=>t)).join("/")}("",t),A[n])return e(A[n]);s=new Image,s.onload=function(){h=S(n,window.location.href),A[function(t){let e=t.replace("."+function(t){return t.split(".").pop()}(t),"");return 2==e.split("/").length?e.replace(y,""):e}(t)]=A[n]=A[h]=this,p("assetLoaded",this,t),e(this)},s.onerror=function(){i(n)},s.src=n}))}class L{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new L(this.x+t.x,this.y+t.y,this)}}class M{constructor(t){return this.init(t)}init(t={}){this.position=function(){return new L(...arguments)}(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){}_pc(){}}class C extends M{init({width:t=0,height:e=0,context:i=m(),render:n=this.draw,update:s=this.advance,anchor:h={x:0,y:0},...r}={}){super.init({width:t,height:e,context:i,anchor:h,...r}),this._di=!0,this._uw(),this._rf=n,this._uf=s,l("init",(()=>{this.context??=m()}))}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y);let e=this.width,i=this.height,n=-e*this.anchor.x,s=-i*this.anchor.y;(n||s)&&t.translate(n,s),this._rf(),(n||s)&&t.translate(-n,-s),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){this._di&&(this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh}}}class O extends C{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...n}={}){super.init({image:t,width:e,height:i,...n})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function j(){return new O(...arguments)}let F=new WeakMap,D={},R={},X={0:"left",1:"middle",2:"right"};function Y(t=g()){return F.get(t)}function G(t,e){return parseFloat(t.getPropertyValue(e))||0}function P(t){let e=null!=t.button?X[t.button]:"left";R[e]=!0,N(t,"onDown")}function B(t){let e=null!=t.button?X[t.button]:"left";R[e]=!1,N(t,"onUp")}function I(t){N(t,"onOver")}function W(t){F.get(t.target)._oo=null,R={}}function q(t,e,i){let n=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let n=e[i];if(n.collidesWithPointer?n.collidesWithPointer(t):a(t,n))return n}}(t);n&&n[e]&&n[e](i),D[e]&&D[e](i,n),"onOver"==e&&(n!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=n)}function N(t,e){t.preventDefault();let i=t.target,n=F.get(i),{scaleX:s,scaleY:h,offsetX:r,offsetY:o}=function(t){let{canvas:e,_s:i}=t,n=e.getBoundingClientRect(),s="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(s[0]),r=parseFloat(s[3]),o=(G(i,"border-left-width")+G(i,"border-right-width"))*h,a=(G(i,"border-top-width")+G(i,"border-bottom-width"))*r,d=(G(i,"padding-left")+G(i,"padding-right"))*h,c=(G(i,"padding-top")+G(i,"padding-bottom"))*r;return{scaleX:(n.width-o-d)/e.width,scaleY:(n.height-a-c)/e.height,offsetX:n.left+(G(i,"border-left-width")+G(i,"padding-left"))*h,offsetY:n.top+(G(i,"border-top-width")+G(i,"padding-top"))*r}}(n);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let a=n.touches[i];a||(a=n.touches[i]={start:{x:(t-r)/s,y:(e-o)/h}},n.touches.length++),a.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:a,identifier:d})=>{let c=n.touches[d];c.changed=!0,c.x=n.x=(i-r)/s,c.y=n.y=(a-o)/h,q(n,e,t),p("touchChanged",t,n.touches),"onUp"==e&&(delete n.touches[d],n.touches.length--,n.touches.length||p("touchEnd"))}))):(n.x=(t.clientX-r)/s,n.y=(t.clientY-o)/h,q(n,e,t))}function U(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function H({fps:t=60,clearCanvas:e=!0,update:i=h,render:n,context:s=m(),blur:r=!1}={}){let o,a,d,c,u,f=0,g=1e3/t,w=1/t,x=e?U:h,_=!0;function y(){if(a=requestAnimationFrame(y),_&&(d=performance.now(),c=d-o,o=d,!(c>1e3))){for(f+=c;f>=g;)p("tick"),u.update(w),f-=g;x(u.context),u.render()}}return r||(window.addEventListener("focus",(()=>{_=!0})),window.addEventListener("blur",(()=>{_=!1}))),l("init",(()=>{u.context??=m()})),u={update:i,render:n,isStopped:!0,context:s,start(){this.isStopped&&(o=performance.now(),this.isStopped=!1,requestAnimationFrame(y))},stop(){this.isStopped=!0,cancelAnimationFrame(a)}},u}let V=[],K={},T={},$={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function z(t){V[t.gamepad.index]={pressedButtons:{},axes:{}}}function J(t){delete V[t.gamepad.index]}function Q(){V.map((t=>{t.pressedButtons={},t.axes={}}))}function Z(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map(((t,e)=>{let n=$[e],{pressed:s}=t,{pressedButtons:h}=V[i.index],r=h[n];!r&&s?[K[i.index],K].map((e=>{e?.[n]?.(i,t,n)})):r&&!s&&[T[i.index],T].map((e=>{e?.[n]?.(i,t,n)})),h[n]=s}));let{axes:n}=V[i.index];n.leftstickx=i.axes[0],n.leftsticky=i.axes[1],n.rightstickx=i.axes[2],n.rightsticky=i.axes[3]}}let tt,et={},it=!1,nt={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,n=Math.abs(e),s=Math.abs(i);if(!(n<this.threshold&&s<this.threshold))return n>s?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let n=i>this.prevDist?"out":"in";return this.prevDist=i,n}}};let st,ht={},rt={},ot={},at={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function dt(t=h,e){t._pd&&e.preventDefault(),t(e)}function ct(t){let e=at[t.code],i=ht[e];ot[e]=!0,dt(i,t)}function ut(t){let e=at[t.code],i=rt[e];ot[e]=!1,dt(i,t)}function lt(){ot={}}function pt(t,e,{handler:i="keydown",preventDefault:n=!0}={}){let s="keydown"==i?ht:rt;e._pd=n,[].concat(t).map((t=>s[t]=e))}function ft(t={}){!function(){let t;for(t=0;t<26;t++)at["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)at["Digit"+t]=at["Numpad"+t]=""+t;window.addEventListener("keydown",ct),window.addEventListener("keyup",ut),window.addEventListener("blur",lt)}();let e=function({radius:t=5,canvas:e=g()}={}){let i=F.get(e);if(!i){let n=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:n},F.set(e,i)}return e.addEventListener("mousedown",P),e.addEventListener("touchstart",P),e.addEventListener("mouseup",B),e.addEventListener("touchend",B),e.addEventListener("touchcancel",B),e.addEventListener("blur",W),e.addEventListener("mousemove",I),e.addEventListener("touchmove",I),i._t||(i._t=!0,l("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0}))),i}(t.pointer);return it||(it=!0,l("touchChanged",((t,e)=>{Object.keys(nt).map((i=>{let n,s=nt[i];(!tt||tt==i)&&e.length==s.touches&&[...Array(e.length).keys()].every((t=>e[t]))&&(n=s[t.type]?.(e)??"")&&et[i+n]&&(tt=i,et[i+n](t,e))}))})),l("touchEnd",(()=>{tt=0}))),window.addEventListener("gamepadconnected",z),window.addEventListener("gamepaddisconnected",J),window.addEventListener("blur",Q),l("tick",Z),{pointer:e}}function gt(){st??=Date.now(),st|=0,st=st+2654435769|0;let t=st^st>>>16;return t=Math.imul(t,569420461),t^=t>>>15,t=Math.imul(t,1935289751),((t^=t>>>15)>>>0)/4294967296}function mt(t,e,i=gt){return(i()*(e-t+1)|0)+t}function wt(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((t=>{e=e.concat(wt(t))})),e}class xt{constructor({id:t,name:e=t,objects:n=[],context:s=m(),cullObjects:h=!0,cullFunction:r=i,sortFunction:a,...d}){this._o=[],Object.assign(this,{id:t,name:e,context:s,cullObjects:h,cullFunction:r,sortFunction:a,...d});let c=this._dn=document.createElement("section");c.tabIndex=-1,c.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",c.id=t,c.setAttribute("aria-label",e);let u=this;this.camera=new class extends C{set x(t){u.sx=t-this.centerX,super.x=t}get x(){return super.x}set y(t){u.sy=t-this.centerY,super.y=t}get y(){return super.y}}({context:s,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(n),this._i=()=>{this.context??=m();let t=this.context.canvas,{width:e,height:i}=t,n=e/2,s=i/2;Object.assign(this.camera,{centerX:n,centerY:s,x:n,y:s,width:e,height:i}),c.isConnected||o(c,t)},this.context&&this._i(),l("init",this._i)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}get node(){return this._dn}add(...t){t.flat().map((t=>{this._o.push(t),t.parent=this,this._dn.append(...wt(t))}))}remove(...t){t.flat().map((t=>{!function(t,e){let i=t.indexOf(e);if(-1!=i)t.splice(i,1)}(this._o,t),t.parent=null,wt(t).map((t=>{o(t,this.context.canvas)}))}))}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find((t=>t.focus));t?t.focus(r):this._dn.focus(r),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){var t,e;t="init",e=this._i,u[t]=(u[t]||[]).filter((t=>t!=e)),this._dn.remove(),this._o.map((t=>t.destroy&&t.destroy()))}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map((e=>e.update&&e.update(t)))}_rf(){let{_o:t,context:e,_sx:i,_sy:n,camera:s,sortFunction:h,cullObjects:r,cullFunction:o}=this;e.translate(i,n);let a=t;r&&(a=a.filter((t=>o(s,t)))),h&&a.sort(h),a.map((t=>t.render&&t.render()))}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:n,centerX:s,centerY:h}=e;t.save(),this._sx=s-i,this._sy=h-n,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}function _t(){return new xt(...arguments)}function yt(t){if(+t==t)return t;let e=[],i=t.split(".."),n=+i[0],s=+i[1],h=n;if(n<s)for(;h<=s;h++)e.push(h);else for(;h>=s;h--)e.push(h);return e}class vt{constructor({image:t,frameWidth:e,frameHeight:i,spacing:n=0,margin:s=0,animations:h}={}){this.animations={},this.image=t,this.frame={width:e,height:i,spacing:n,margin:s},this._f=(t.width-s)/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:n,frameRate:s,loop:h}=t[i];e=[],[].concat(n).map((t=>{e=e.concat(yt(t))})),this.animations[i]=_({spriteSheet:this,frames:e,frameRate:s,loop:h,name:i})}}}function bt(){return new vt(...arguments)}export{H as GameLoop,C as GameObjectClass,_t as Scene,j as Sprite,O as SpriteClass,bt as SpriteSheet,t as angleToTarget,i as collides,s as depthSort,Y as getPointer,w as init,ft as initInput,E as loadImage,e as movePoint,pt as onKey,mt as randInt};
